"use strict";(()=>{var e={};e.id=8447,e.ids=[8447],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},81214:(e,i,r)=>{r.r(i),r.d(i,{originalPathname:()=>f,patchFetch:()=>b,requestAsyncStorage:()=>v,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>z});var t={};r.r(t),r.d(t,{GET:()=>c,POST:()=>p,dynamic:()=>m});var n=r(49303),s=r(88716),a=r(60670),o=r(87070),u=r(9487),l=r(90455),d=r(30971);let m="force-dynamic";async function c(e,{params:i}){try{let e=await (0,l.mk)();if(!await u._.venue.findUnique({where:{id:i.id,ownerId:e.id}}))return o.NextResponse.json({error:"Venue not found or access denied"},{status:404});let r=await u._.venueAvailability.findMany({where:{venueId:i.id},orderBy:{dayOfWeek:"asc"}});return o.NextResponse.json({availability:r})}catch(e){return console.error("Get venue availability error:",e),o.NextResponse.json({error:"Failed to fetch venue availability"},{status:500})}}async function p(e,{params:i}){try{let r=await (0,l.mk)(),t=await e.json(),n=d.i6.parse(t);if(!await u._.venue.findUnique({where:{id:i.id,ownerId:r.id}}))return o.NextResponse.json({error:"Venue not found or access denied"},{status:404});let s=await u._.venueAvailability.upsert({where:{venueId_dayOfWeek:{venueId:i.id,dayOfWeek:n.dayOfWeek}},update:{openTime:n.openTime,closeTime:n.closeTime,isOpen:n.isOpen},create:{venueId:i.id,dayOfWeek:n.dayOfWeek,openTime:n.openTime,closeTime:n.closeTime,isOpen:n.isOpen}});return o.NextResponse.json({availability:s})}catch(e){return console.error("Create venue availability error:",e),o.NextResponse.json({error:"Failed to create venue availability"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/venues/[id]/availability/route",pathname:"/api/venues/[id]/availability",filename:"route",bundlePath:"app/api/venues/[id]/availability/route"},resolvedPagePath:"/home/ubuntu/sully-booking-system/app/app/api/venues/[id]/availability/route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:v,staticGenerationAsyncStorage:z,serverHooks:y}=g,f="/api/venues/[id]/availability/route";function b(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:z})}},90455:(e,i,r)=>{r.d(i,{Gg:()=>p,Gv:()=>m,Sk:()=>v,c_:()=>d,ed:()=>c,mk:()=>g});var t=r(42023),n=r.n(t),s=r(41482),a=r.n(s),o=r(71615),u=r(9487);let l=process.env.JWT_SECRET||"sully-booking-system-secret-key";async function d(e){return n().hash(e,12)}async function m(e,i){return n().compare(e,i)}async function c(e){var i;let r=(i={userId:e},a().sign(i,l,{expiresIn:"7d"})),t=new Date;return t.setDate(t.getDate()+7),await u._.userSession.create({data:{userId:e,token:r,expiresAt:t}}),r}async function p(){console.log("\uD83D\uDD35 [AUTH-LIB] Getting session");try{let e=(0,o.cookies)(),i=e.get("auth-token")?.value;if(console.log("\uD83D\uDD35 [AUTH-LIB] Token from cookies:",i?`Token found (${i.substring(0,20)}...)`:"No token found"),!i)return console.log("\uD83D\uDD35 [AUTH-LIB] No auth token found in cookies"),null;console.log("\uD83D\uDD35 [AUTH-LIB] Looking up session in database");let r=await u._.userSession.findUnique({where:{token:i},include:{user:!0}});if(!r)return console.log("\uD83D\uDD34 [AUTH-LIB] No session found in database for token"),null;if(console.log("\uD83D\uDD35 [AUTH-LIB] Session found, checking expiration"),r.expiresAt<new Date)return console.log("\uD83D\uDD34 [AUTH-LIB] Session expired, deleting"),await u._.userSession.delete({where:{id:r.id}}),null;return console.log("\uD83D\uDFE2 [AUTH-LIB] Valid session found for user:",r.user.email),{id:r.user.id,email:r.user.email,firstName:r.user.firstName,lastName:r.user.lastName,role:r.user.role,isActive:r.user.isActive}}catch(e){return console.error("\uD83D\uDD34 [AUTH-LIB] Session error:",e),console.error("\uD83D\uDD34 [AUTH-LIB] Error stack:",e?.stack),null}}async function g(e){let i=await p();if(!i)throw Error("Authentication required");if(!i.isActive)throw Error("Account is inactive");if(e&&!e.includes(i.role))throw Error("Insufficient permissions");return i}async function v(e){try{let i=e.cookies.get("auth-token")?.value;if(!i)return null;let r=await u._.userSession.findUnique({where:{token:i},include:{user:!0}});if(!r)return null;if(r.expiresAt<new Date)return await u._.userSession.delete({where:{id:r.id}}),null;if(!r.user.isActive)return null;return{id:r.user.id,email:r.user.email,firstName:r.user.firstName,lastName:r.user.lastName,role:r.user.role,isActive:r.user.isActive}}catch(e){return console.error("Error getting user from token:",e),null}}},9487:(e,i,r)=>{r.d(i,{_:()=>n});var t=r(53524);let n=globalThis.prisma??new t.PrismaClient},30971:(e,i,r)=>{r.d(i,{Tu:()=>o,WV:()=>l,Yy:()=>u,dm:()=>s,gY:()=>a,i6:()=>d,sY:()=>c,tw:()=>p});var t=r(7410),n=r(53524);let s=t.z.object({email:t.z.string().email("Invalid email address"),password:t.z.string().min(6,"Password must be at least 6 characters")}),a=t.z.object({email:t.z.string().email("Invalid email address"),password:t.z.string().min(6,"Password must be at least 6 characters"),firstName:t.z.string().min(1,"First name is required"),lastName:t.z.string().min(1,"Last name is required"),phone:t.z.string().optional()}),o=t.z.object({name:t.z.string().min(1,"Venue name is required"),description:t.z.string().optional(),address:t.z.string().min(1,"Address is required"),city:t.z.string().min(1,"City is required"),postcode:t.z.string().min(1,"Postcode is required"),phone:t.z.string().min(1,"Phone is required"),email:t.z.string().email("Invalid email address"),website:t.z.string().url().optional().or(t.z.literal("")),cuisine:t.z.string().optional(),venueType:t.z.nativeEnum(n.VenueType),capacity:t.z.number().min(1,"Capacity must be at least 1")}),u=t.z.object({venueId:t.z.string().min(1,"Venue is required"),serviceType:t.z.nativeEnum(n.ServiceType),date:t.z.string().min(1,"Date is required"),time:t.z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format"),partySize:t.z.number().min(1,"Party size must be at least 1"),customerName:t.z.string().min(1,"Customer name is required"),customerEmail:t.z.string().email("Invalid email address"),customerPhone:t.z.string().min(1,"Phone number is required"),specialRequests:t.z.string().optional(),tableId:t.z.string().optional()}),l=t.z.object({name:t.z.string().min(1,"Table name is required"),capacity:t.z.number().min(1,"Capacity must be at least 1"),description:t.z.string().optional()});t.z.object({name:t.z.string().min(1,"Event name is required"),description:t.z.string().optional(),date:t.z.string().min(1,"Date is required"),startTime:t.z.string().min(1,"Start time is required"),endTime:t.z.string().min(1,"End time is required"),capacity:t.z.number().min(1,"Capacity must be at least 1"),price:t.z.number().min(0,"Price must be positive").optional()});let d=t.z.object({dayOfWeek:t.z.number().min(0).max(6),openTime:t.z.string().min(1,"Open time is required"),closeTime:t.z.string().min(1,"Close time is required"),isOpen:t.z.boolean()}),m=t.z.object({dayOfWeek:t.z.number().min(0).max(6),openTime:t.z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format"),closeTime:t.z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format"),name:t.z.string().optional(),isActive:t.z.boolean().default(!0)}),c=t.z.object({openingHours:t.z.array(m)}),p=t.z.object({name:t.z.string().min(1,"Widget name is required"),settings:t.z.object({theme:t.z.string().optional(),primaryColor:t.z.string().optional(),showLogo:t.z.boolean().optional(),allowedServices:t.z.array(t.z.nativeEnum(n.ServiceType)).optional()}).optional()})}};var i=require("../../../../../webpack-runtime.js");i.C(e);var r=e=>i(i.s=e),t=i.X(0,[9276,5972,3954,7410],()=>r(81214));module.exports=t})();