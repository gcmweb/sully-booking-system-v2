"use strict";(()=>{var e={};e.id=7098,e.ids=[7098],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},59876:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>b,serverHooks:()=>h,staticGenerationAsyncStorage:()=>k});var a={};i.r(a),i.d(a,{POST:()=>g,dynamic:()=>v});var o=i(49303),r=i(88716),s=i(60670),n=i(87070),u=i(9487),c=i(30971),p=i(4589),d=i(86287),l=i(76876),m=i(53524);let v="force-dynamic";async function g(e){try{let t=await e.json(),i=c.Yy.parse(t),a=await u._.venue.findUnique({where:{id:i.venueId,isActive:!0}});if(!a)return n.NextResponse.json({error:"Venue not found or not available for bookings"},{status:404});if(!(await (0,d.XA)(i.venueId)).canCreateBooking)return n.NextResponse.json({error:"This venue has reached its booking limit. Please contact the venue directly."},{status:403});let o=new Date(i.date),r=await (0,p.gR)(i.venueId,o,i.time,i.partySize,i.serviceType,i.tableId);if(!r.available)return n.NextResponse.json({error:r.reason},{status:409});let s=await u._.booking.create({data:{...i,date:o,status:m.BookingStatus.PENDING,source:m.BookingSource.DIRECT},include:{venue:{select:{id:!0,name:!0,address:!0,city:!0,phone:!0,email:!0}},table:{select:{id:!0,name:!0}}}});return await (0,d.GC)(i.venueId),await (0,l.jJ)(i.customerEmail,{bookingId:s.id,customerName:i.customerName,venueName:a.name,venueAddress:`${a.address}, ${a.city}`,venuePhone:a.phone,date:o.toDateString(),time:i.time,partySize:i.partySize,serviceType:i.serviceType,specialRequests:i.specialRequests}),await (0,l.sc)(a.ownerId,m.NotificationType.BOOKING_CONFIRMATION,"New Booking Received",`New ${i.serviceType.toLowerCase()} booking from ${i.customerName} for ${o.toDateString()} at ${i.time}`,{bookingId:s.id}),n.NextResponse.json({booking:{id:s.id,status:s.status,date:s.date,time:s.time,partySize:s.partySize,serviceType:s.serviceType,venue:s.venue,table:s.table},message:"Booking created successfully! You will receive a confirmation email shortly."})}catch(e){return console.error("Create public booking error:",e),n.NextResponse.json({error:"Failed to create booking. Please try again."},{status:500})}}let b=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/public/bookings/route",pathname:"/api/public/bookings",filename:"route",bundlePath:"app/api/public/bookings/route"},resolvedPagePath:"/home/ubuntu/sully-booking-system/app/app/api/public/bookings/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:k,serverHooks:h}=b,f="/api/public/bookings/route";function w(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:k})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[9276,5972,7410,7752],()=>i(59876));module.exports=a})();