(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9674],{7793:function(e,s,a){Promise.resolve().then(a.bind(a,6364))},6364:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return E}});var l=a(7437),i=a(2265),t=a(6413),r=a(9376),n=a(6070),c=a(2869),d=a(5974),x=a(5186),o=a(3647),h=a(3578),m=a(6110),u=a(7099),j=a(2660),p=a(740),f=a(3247),N=a(5805),v=a(2208);let g=(0,a(9205).Z)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var y=a(9663),b=a(8930),w=a(2451),C=a(407),A=a(7648),S=a(429),k=a(4438);function E(){let{user:e,loading:s}=(0,t.a)(),a=(0,r.useRouter)(),[E,_]=(0,i.useState)([]),[U,V]=(0,i.useState)({page:1,limit:10,total:0,pages:0}),[F,D]=(0,i.useState)(!0),[R,Z]=(0,i.useState)(""),[z,O]=(0,i.useState)("all"),[P,L]=(0,i.useState)(null),[M,T]=(0,i.useState)(!1),[I,B]=(0,i.useState)(!1),[Q,q]=(0,i.useState)(null);(0,i.useEffect)(()=>{s||e&&"SUPER_ADMIN"===e.role||a.push("/dashboard")},[e,s,a]),(0,i.useEffect)(()=>{e&&"SUPER_ADMIN"===e.role&&H()},[e,U.page,z]);let H=async()=>{try{D(!0);let e=new URLSearchParams({page:U.page.toString(),limit:U.limit.toString()});"all"!==z&&e.append("role",z);let s=await fetch("/api/admin/users?".concat(e));if(s.ok){let e=await s.json();_(e.users),V(e.pagination)}else k.A.error("Failed to fetch users")}catch(e){console.error("Failed to fetch users:",e),k.A.error("Failed to fetch users")}finally{D(!1)}},J=async(e,s)=>{try{(await fetch("/api/admin/users/".concat(e,"/toggle-status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!s})})).ok?(k.A.success("User ".concat(s?"disabled":"enabled"," successfully")),H()):k.A.error("Failed to update user status")}catch(e){console.error("Failed to toggle user status:",e),k.A.error("Failed to update user status")}},Y=async e=>{try{(await fetch("/api/admin/users/".concat(e),{method:"DELETE"})).ok?(k.A.success("User deleted successfully"),H(),B(!1),q(null)):k.A.error("Failed to delete user")}catch(e){console.error("Failed to delete user:",e),k.A.error("Failed to delete user")}},W=E.filter(e=>e.firstName.toLowerCase().includes(R.toLowerCase())||e.lastName.toLowerCase().includes(R.toLowerCase())||e.email.toLowerCase().includes(R.toLowerCase())),$=e=>{switch(e){case"SUPER_ADMIN":return"bg-red-100 text-red-800";case"VENUE_OWNER":return"bg-blue-100 text-blue-800";case"VENUE_STAFF":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return s||!e||"SUPER_ADMIN"!==e.role?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsx)("div",{className:"flex justify-between items-center h-16",children:(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)(A.default,{href:"/admin",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[(0,l.jsx)(j.Z,{className:"h-5 w-5"}),(0,l.jsx)("span",{children:"Back to Admin"})]}),(0,l.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,l.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"User Management"})]})})})}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsx)(S.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-6",children:(0,l.jsxs)(n.Zb,{children:[(0,l.jsx)(n.Ol,{children:(0,l.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,l.jsx)(p.Z,{className:"h-5 w-5"}),(0,l.jsx)("span",{children:"Filters & Search"})]})}),(0,l.jsx)(n.aY,{children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(f.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,l.jsx)(x.I,{placeholder:"Search users by name or email...",value:R,onChange:e=>Z(e.target.value),className:"pl-10"})]})}),(0,l.jsx)("div",{className:"w-full md:w-48",children:(0,l.jsxs)(o.Ph,{value:z,onValueChange:O,children:[(0,l.jsx)(o.i4,{children:(0,l.jsx)(o.ki,{placeholder:"Filter by role"})}),(0,l.jsxs)(o.Bw,{children:[(0,l.jsx)(o.Ql,{value:"all",children:"All Roles"}),(0,l.jsx)(o.Ql,{value:"SUPER_ADMIN",children:"Super Admin"}),(0,l.jsx)(o.Ql,{value:"VENUE_OWNER",children:"Venue Owner"}),(0,l.jsx)(o.Ql,{value:"VENUE_STAFF",children:"Venue Staff"}),(0,l.jsx)(o.Ql,{value:"CUSTOMER",children:"Customer"})]})]})})]})})]})}),(0,l.jsx)(S.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.1},children:(0,l.jsxs)(n.Zb,{children:[(0,l.jsx)(n.Ol,{children:(0,l.jsx)(n.ll,{className:"flex items-center justify-between",children:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(N.Z,{className:"h-5 w-5"}),(0,l.jsxs)("span",{children:["Users (",U.total,")"]})]})})}),(0,l.jsx)(n.aY,{children:F?(0,l.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(h.iA,{children:[(0,l.jsx)(h.xD,{children:(0,l.jsxs)(h.SC,{children:[(0,l.jsx)(h.ss,{children:"User"}),(0,l.jsx)(h.ss,{children:"Role"}),(0,l.jsx)(h.ss,{children:"Status"}),(0,l.jsx)(h.ss,{children:"Venues"}),(0,l.jsx)(h.ss,{children:"Bookings"}),(0,l.jsx)(h.ss,{children:"Joined"}),(0,l.jsx)(h.ss,{children:"Actions"})]})}),(0,l.jsx)(h.RM,{children:W.map(e=>(0,l.jsxs)(h.SC,{children:[(0,l.jsx)(h.pj,{children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"font-medium",children:[e.firstName," ",e.lastName]}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:e.email}),e.phone&&(0,l.jsx)("div",{className:"text-sm text-gray-500",children:e.phone})]})}),(0,l.jsx)(h.pj,{children:(0,l.jsx)(d.C,{className:$(e.role),children:e.role.replace("_"," ")})}),(0,l.jsx)(h.pj,{children:(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)(d.C,{variant:e.isActive?"default":"destructive",children:e.isActive?"Active":"Inactive"}),e.emailVerified&&(0,l.jsx)(d.C,{variant:"outline",className:"text-xs",children:"Verified"})]})}),(0,l.jsx)(h.pj,{children:e._count.venues}),(0,l.jsx)(h.pj,{children:e._count.bookings}),(0,l.jsx)(h.pj,{children:new Date(e.createdAt).toLocaleDateString()}),(0,l.jsx)(h.pj,{children:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>{L(e),T(!0)},children:(0,l.jsx)(v.Z,{className:"h-4 w-4"})}),(0,l.jsx)(c.z,{variant:e.isActive?"destructive":"default",size:"sm",onClick:()=>J(e.id,e.isActive),children:e.isActive?(0,l.jsx)(g,{className:"h-4 w-4"}):(0,l.jsx)(y.Z,{className:"h-4 w-4"})}),(0,l.jsx)(c.z,{variant:"destructive",size:"sm",onClick:()=>{q(e),B(!0)},children:(0,l.jsx)(b.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})}),U.pages>1&&(0,l.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["Showing ",(U.page-1)*U.limit+1," to"," ",Math.min(U.page*U.limit,U.total)," of"," ",U.total," users"]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>V(e=>({...e,page:e.page-1})),disabled:1===U.page,children:[(0,l.jsx)(w.Z,{className:"h-4 w-4"}),"Previous"]}),(0,l.jsxs)("span",{className:"text-sm",children:["Page ",U.page," of ",U.pages]}),(0,l.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>V(e=>({...e,page:e.page+1})),disabled:U.page===U.pages,children:["Next",(0,l.jsx)(C.Z,{className:"h-4 w-4"})]})]})]})]})})]})})]}),(0,l.jsx)(m.Vq,{open:M,onOpenChange:T,children:(0,l.jsxs)(m.cZ,{className:"max-w-2xl",children:[(0,l.jsxs)(m.fK,{children:[(0,l.jsx)(m.$N,{children:"User Details"}),(0,l.jsx)(m.Be,{children:"Detailed information about the selected user"})]}),P&&(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Name"}),(0,l.jsxs)("p",{className:"text-sm",children:[P.firstName," ",P.lastName]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,l.jsx)("p",{className:"text-sm",children:P.email})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Phone"}),(0,l.jsx)("p",{className:"text-sm",children:P.phone||"Not provided"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Role"}),(0,l.jsx)(d.C,{className:$(P.role),children:P.role.replace("_"," ")})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Status"}),(0,l.jsx)(d.C,{variant:P.isActive?"default":"destructive",children:P.isActive?"Active":"Inactive"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Email Verified"}),(0,l.jsx)(d.C,{variant:P.emailVerified?"default":"secondary",children:P.emailVerified?"Verified":"Not Verified"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Venues"}),(0,l.jsx)("p",{className:"text-sm",children:P._count.venues})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Bookings"}),(0,l.jsx)("p",{className:"text-sm",children:P._count.bookings})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-500",children:"Joined"}),(0,l.jsx)("p",{className:"text-sm",children:new Date(P.createdAt).toLocaleDateString()})]})]})}),(0,l.jsx)(m.cN,{children:(0,l.jsx)(c.z,{variant:"outline",onClick:()=>T(!1),children:"Close"})})]})}),(0,l.jsx)(u.aR,{open:I,onOpenChange:B,children:(0,l.jsxs)(u._T,{children:[(0,l.jsxs)(u.fY,{children:[(0,l.jsx)(u.f$,{children:"Delete User"}),(0,l.jsxs)(u.yT,{children:["Are you sure you want to delete ",null==Q?void 0:Q.firstName," ",null==Q?void 0:Q.lastName,"? This action cannot be undone and will also delete all associated data."]})]}),(0,l.jsxs)(u.xo,{children:[(0,l.jsx)(u.le,{onClick:()=>q(null),children:"Cancel"}),(0,l.jsx)(u.OL,{onClick:()=>Q&&Y(Q.id),className:"bg-red-600 hover:bg-red-700",children:"Delete User"})]})]})})]})}},9663:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});let l=(0,a(9205).Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]])}},function(e){e.O(0,[8590,4671,429,1596,1345,4799,9856,7108,2971,2117,1744],function(){return e(e.s=7793)}),_N_E=e.O()}]);